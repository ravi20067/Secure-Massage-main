<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Login | SecureChat</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Existing CSS -->
    <link th:href="@{/css/dashboard.css}" rel="stylesheet">

    <!-- PAGE-SCOPED STYLES -->
    <style>
        /* ===============================
           PAGE: LOGIN
           =============================== */

        .page-login {
            background: radial-gradient(circle at top, #111827, #000);
            color: #f8fafc;
            min-height: 100vh;
        }

        .page-login .login-card {
            width: 100%;
            max-width: 420px;
            background: linear-gradient(180deg, #0f172a, #020617);
            border-radius: 18px;
            border: 1px solid rgba(255,255,255,.08);
            animation: loginFadeUp .7s ease;
        }

        .page-login h4 {
            font-weight: 600;
        }

        .page-login label {
            font-size: .9rem;
            opacity: .85;
        }

        /* Inputs */
        .page-login input {
            background: #020617;
            border: 1px solid rgba(255,255,255,.12);
            color: #fff;
        }

        .page-login input::placeholder {
            color: rgba(255,255,255,.45);
        }

        .page-login input:focus {
            background: #020617;
            color: #fff;
            border-color: #6366f1;
            box-shadow: 0 0 0 .15rem rgba(99,102,241,.35);
        }

        /* Forgot password link */
        .page-login a.small {
            color: #93c5fd;
        }

        .page-login a.small:hover {
            text-decoration: underline;
        }

        /* Captcha */
        .page-login .captcha-box {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .page-login .captcha-box img {
            height: 42px;
            border-radius: 8px;
            background: #fff;
            border: 1px solid rgba(255,255,255,.15);
        }

        .page-login .captcha-refresh {
            background: transparent;
            border: none;
            color: #93c5fd;
            font-size: .9rem;
        }

        .page-login .captcha-refresh:hover {
            text-decoration: underline;
        }

        /* Buttons */
        .page-login .btn-primary {
            background: linear-gradient(135deg, #4f46e5, #2563eb);
            border: none;
            box-shadow: 0 10px 30px rgba(79,70,229,.4);
        }

        .page-login .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 14px 40px rgba(79,70,229,.6);
        }

        .page-login .btn-danger {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            border: none;
        }

        /* Divider */
        .page-login hr {
            border-color: rgba(255,255,255,.15);
        }

        /* Register link */
        .page-login p a {
            color: #93c5fd;
        }

        .page-login p a:hover {
            text-decoration: underline;
        }

        /* ===============================
           RESPONSIVE
           =============================== */

        @media (max-width: 576px) {
            .page-login .login-card {
                padding: 24px 20px;
            }
        }

        /* ===============================
           ANIMATION (LOGIN ONLY)
           =============================== */

        @keyframes loginFadeUp {
            from {
                opacity: 0;
                transform: translateY(18px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* ===== TEXT VISIBILITY FIX (LOGIN PAGE) ===== */
        .page-login .text-secondary,
        .page-login .text-muted {
           color: #cbd5f5 !important;
}

    </style>
</head>

<body class="page-login">

<!-- HEADER -->
<div th:replace="~{layout/header :: header}"></div>

<!-- LOGIN SECTION -->
<div class="container d-flex justify-content-center align-items-center py-5">
    <div class="card p-4 shadow-lg login-card">

        <h4 class="text-center mb-2">üëã Hello, Welcome Back</h4>
        <p class="text-center text-secondary mb-4">
            Login to continue secure messaging
        </p>

        <!-- Error Message -->
        <div th:if="${param.error}" class="alert alert-danger text-center">
            Invalid username or password
        </div>

        <!-- Logout Message -->
        <div th:if="${param.logout}" class="alert alert-success text-center">
            You have been logged out successfully
        </div>

        <div th:if="${param.captchaError}" class="alert alert-danger text-center">
            ‚ùå Invalid Captcha
        </div>

        <!-- Login Form -->
        <form th:action="@{/perform_login}" method="post">

            <div class="mb-3">
                <label>Email</label>
                <input type="text" name="username"
                       class="form-control"
                       placeholder="Enter email" required>
            </div>

            <div class="mb-3">
                <label>Password</label>
                <input type="password" name="password"
                       class="form-control"
                       placeholder="Enter password" required>
            </div>

            <div class="text-end mb-3">
                <a href="/login/forgot-password" class="small text-decoration-none">
                    Forgot password?
                </a>
            </div>

            <div class="captcha-box">
                <img id="captchaImg" src="" alt="Captcha">
                <button type="button"
                        class="captcha-refresh"
                        onclick="loadCaptcha()">
                    Refresh
                </button>
            </div>

            <input type="hidden" name="captchaId" id="captchaId">

            <div class="mb-3">
                <input type="text" name="captcha"
                       class="form-control"
                       placeholder="Enter Captcha" required>
            </div>

            <button type="submit" class="btn btn-primary w-100 mt-2">
                <i class="bi bi-box-arrow-in-right"></i> Login
            </button>
        </form>

        <hr class="my-4">

        <a href="/oauth2/authorization/google"
           class="btn btn-danger w-100 mb-3">
            <i class="bi bi-google"></i> Sign in with Google
        </a>

        <p class="text-center mb-0">
            Don‚Äôt have an account?
            <a href="/register" class="text-decoration-none">
                Create one
            </a>
        </p>

    </div>
</div>

<!-- FOOTER -->
<div th:replace="~{layout/footer :: footer}"></div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/login-js.js}"></script>

</body>
</html>

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Register | SecureChat</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <link th:href="@{/css/dashboard.css}" rel="stylesheet">

    <!-- PAGE-SCOPED STYLES -->
    <style>
        /* ===============================
           PAGE: REGISTER
           =============================== */

        .page-register {
            background: radial-gradient(circle at top, #111827, #000);
            color: #f8fafc;
            min-height: 100vh;
        }

        .page-register .register-card {
            width: 100%;
            max-width: 460px;
            background: linear-gradient(180deg, #0f172a, #020617);
            border-radius: 18px;
            border: 1px solid rgba(255,255,255,.08);
            animation: registerFadeUp .7s ease;
        }

        .page-register h4 {
            font-weight: 600;
        }

        .page-register label {
            font-size: .9rem;
            opacity: .85;
        }

        /* Inputs */
        .page-register input {
            background: #020617;
            border: 1px solid rgba(255,255,255,.12);
            color: #fff;
        }

        .page-register input::placeholder {
            color: rgba(255,255,255,.45);
        }

        .page-register input:focus {
            background: #020617;
            color: #fff;
            border-color: #6366f1;
            box-shadow: 0 0 0 .15rem rgba(99,102,241,.35);
        }

        /* Captcha */
        .page-register .captcha-box {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .page-register .captcha-box img {
            height: 42px;
            border-radius: 8px;
            background: #fff;
            border: 1px solid rgba(255,255,255,.15);
        }

        .page-register .captcha-refresh {
            background: transparent;
            border: none;
            color: #93c5fd;
            font-size: .9rem;
        }

        .page-register .captcha-refresh:hover {
            text-decoration: underline;
        }

        /* Buttons */
        .page-register .btn-outline-primary {
            border-color: #6366f1;
            color: #a5b4fc;
        }

        .page-register .btn-outline-primary:hover {
            background: #6366f1;
            color: #fff;
        }

        .page-register .btn-success {
            background: linear-gradient(135deg, #16a34a, #22c55e);
            border: none;
            box-shadow: 0 10px 30px rgba(34,197,94,.35);
        }

        .page-register .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 14px 40px rgba(34,197,94,.55);
        }

        .page-register .btn-danger {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            border: none;
        }

        /* Alerts */
        .page-register .alert {
            font-size: .9rem;
        }

        /* Divider */
        .page-register hr {
            border-color: rgba(255,255,255,.15);
        }

        /* Links */
        .page-register a {
            color: #93c5fd;
        }

        .page-register a:hover {
            text-decoration: underline;
        }

        /* ===============================
           RESPONSIVE
           =============================== */

        @media (max-width: 576px) {
            .page-register .register-card {
                padding: 24px 20px;
            }
        }

        /* ===============================
           ANIMATION (REGISTER ONLY)
           =============================== */

        @keyframes registerFadeUp {
            from {
                opacity: 0;
                transform: translateY(18px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="page-register">

<!-- HEADER -->
<div th:replace="~{layout/header :: header}"></div>

<!-- REGISTER SECTION -->
<div class="container d-flex justify-content-center align-items-center py-5">
    <div class="card p-4 shadow-lg register-card">

        <h4 class="text-center mb-2">üéâ Hello, Join SecureChat</h4>
        <p class="text-center text-secondary mb-4">
            Create your account to start secure messaging
        </p>

        <div id="successBox" class="alert alert-success text-center d-none">
            <span id="success"></span>
        </div>

        <div id="errorBox" class="alert alert-danger text-center d-none">
            <span id="error"></span>
        </div>

        <div th:if="${param.captchaError}" class="alert alert-danger text-center">
            ‚ùå Invalid Captcha
        </div>

        <!-- Registration Form -->
        <form th:object="${user}">

            <div class="mb-3">
                <label>Name</label>
                <input id="name" type="text" th:field="*{name}"
                       class="form-control" required>
            </div>

            <div class="mb-3">
                <label>Email</label>
                <input id="email" type="email" th:field="*{email}"
                       class="form-control" required>
            </div>

            <div class="mb-3">
                <label>Password</label>
                <input id="password" type="password" th:field="*{password}"
                       class="form-control" required>
            </div>

            <div class="captcha-box">
                <img id="captchaImg" src="" alt="Captcha">
                <button type="button"
                        class="captcha-refresh"
                        onclick="loadCaptcha()">
                    Refresh
                </button>
            </div>

            <input type="hidden" name="captchaId" id="captchaId">

            <div class="mb-3">
                <input type="text" name="captcha" id="captcha"
                       class="form-control"
                       placeholder="Enter Captcha" required>
            </div>

            <!-- SEND OTP -->
            <button type="button"
                    class="btn btn-outline-primary w-100"
                    onclick="sendOtp()">
                Send OTP
            </button>

            <!-- OTP SECTION -->
            <div id="otpSection" class="mt-3 d-none">
                <label>Enter OTP</label>
                <input type="text" id="otp" class="form-control mb-3">

                <button type="button"
                        class="btn btn-success w-100"
                        onclick="verifyOtpAndSubmit()">
                    Verify OTP & Create Account
                </button>
            </div>
        </form>

        <script src="/js/register-otp.js"></script>

        <hr class="my-4">

        <a href="/oauth2/authorization/google"
           class="btn btn-danger w-100 mb-3">
            <i class="bi bi-google"></i> Sign in with Google
        </a>

        <p class="text-center mb-0">
            Already have an account?
            <a href="/login" class="text-decoration-none">Login here</a>
        </p>

    </div>
</div>

<!-- FOOTER -->
<div th:replace="~{layout/footer :: footer}"></div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/register-js.js}"></script>

</body>
</html>
